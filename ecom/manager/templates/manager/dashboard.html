{% extends "manager/base_admin.html" %}
{% block title %}Dashboard | Admin{% endblock %}

{% block content %}
<h3 class="mb-4">Dashboard</h3>

<div class="row g-3 mb-4">
  <div class="col-sm-6 col-lg-4">
    <div class="card card-kpi p-3">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <small class="text-secondary">Total Products</small>
          <h3 class="mb-0">{{ total_products }}</h3>
        </div>
        <span class="fs-3">üõçÔ∏è</span>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-lg-4">
    <div class="card card-kpi p-3">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <small class="text-secondary">Customers</small>
          <h3 class="mb-0">{{ total_customers }}</h3>
        </div>
        <span class="fs-3">üë•</span>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-lg-4">
    <div class="card card-kpi p-3">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <small class="text-secondary">Sales (cart sum)</small>
          <h3 class="mb-0">‚Çπ{{ total_sales }}</h3>
        </div>
        <span class="fs-3">üí∞</span>
      </div>
    </div>
  </div>
</div>

<div class="card card-kpi p-3">
  <h6 class="mb-3">Top Products (by quantity in carts)</h6>
  <canvas id="topChart"></canvas>
</div>

{{ chart_labels|json_script:"labels-data" }}
{{ chart_data|json_script:"values-data" }}
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = JSON.parse(document.getElementById('labels-data').textContent);
  const values = JSON.parse(document.getElementById('values-data').textContent);

  const ctx = document.getElementById('topChart');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{ label: 'Qty', data: values }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false }},
      scales: { y: { beginAtZero: true } }
    }
  });
</script>
{% endblock %}
